<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase í†µê³„ ë°ì´í„° í™•ì¸</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff00;
            padding: 20px;
            line-height: 1.6;
        }
        h1 { color: #00ffff; }
        h2 { color: #ffff00; margin-top: 30px; }
        .section {
            background: #1a1a1a;
            border: 1px solid #00ff00;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .member-data {
            background: #2a2a2a;
            padding: 10px;
            margin: 10px 0;
            border-left: 3px solid #00ffff;
        }
        .tier { color: #ffd700; font-weight: bold; }
        .kda { color: #ff69b4; }
        .damage { color: #87ceeb; }
        .error { color: #ff0000; }
        .success { color: #00ff00; }
        .path { color: #999; font-size: 0.9em; }
        pre { 
            background: #000; 
            padding: 10px; 
            overflow-x: auto;
            border: 1px solid #333;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Firebase í†µê³„ ë°ì´í„° ì‹¤ì‹œê°„ ì¡°íšŒ</h1>
    
    <div class="section">
        <h2>1ï¸âƒ£ ë©¤ë²„ë³„ í˜„ì¬ í†µê³„ (currentStats)</h2>
        <div class="path">ê²½ë¡œ: members/{memberKey}/currentStats/</div>
        <div id="currentStats">ë¡œë”© ì¤‘...</div>
    </div>
    
    <div class="section">
        <h2>2ï¸âƒ£ ì˜¤ëŠ˜ì˜ ì¼ì¼ ìŠ¤ëƒ…ìƒ· (daily)</h2>
        <div class="path">ê²½ë¡œ: stats/daily/{today}/</div>
        <div id="dailyStats">ë¡œë”© ì¤‘...</div>
    </div>
    
    <div class="section">
        <h2>3ï¸âƒ£ ë©¤ë²„ë³„ íˆìŠ¤í† ë¦¬ (history)</h2>
        <div class="path">ê²½ë¡œ: stats/history/{memberKey}/{date}/</div>
        <div id="historyStats">ë¡œë”© ì¤‘...</div>
    </div>
    
    <div class="section">
        <h2>4ï¸âƒ£ ë§ˆì§€ë§‰ ìˆ˜ì§‘ ì •ë³´ (metadata)</h2>
        <div class="path">ê²½ë¡œ: stats/metadata/lastCollection/</div>
        <div id="metadata">ë¡œë”© ì¤‘...</div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
        import { getDatabase, ref, onValue, get } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyCWEWmussrZcqv4LgCvjUdcuzRcaUST3Ls",
            authDomain: "cs-homepage-5c3c2.firebaseapp.com",
            databaseURL: "https://cs-homepage-5c3c2-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "cs-homepage-5c3c2",
            storageBucket: "cs-homepage-5c3c2.firebasestorage.app",
            messagingSenderId: "117726976721",
            appId: "1:117726976721:web:f9dd3297e82113414183f0"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        // 1. ë©¤ë²„ë³„ í˜„ì¬ í†µê³„ ì¡°íšŒ
        async function checkCurrentStats() {
            const membersRef = ref(database, 'members');
            const snapshot = await get(membersRef);
            const members = snapshot.val() || {};
            
            let html = '';
            let memberCount = 0;
            let tierCount = 0;
            
            for (const [key, member] of Object.entries(members)) {
                memberCount++;
                const stats = member.currentStats || {};
                const hasTier = stats.tier ? true : false;
                if (hasTier) tierCount++;
                
                html += `
                    <div class="member-data">
                        <strong>${member.name}</strong> (${key})
                        <br>ğŸ“Š ì¼ë°˜: KD ${stats.kd || 'N/A'}, í‰ê· ë€ ${stats.avgDamage || 'N/A'}
                        <br>ğŸ® ë­í¬: <span class="tier">í‹°ì–´ ${stats.tier || 'ì—†ìŒ'}</span>, 
                        <span class="kda">KDA ${stats.rankedKda || 'N/A'}</span>, 
                        <span class="damage">í‰ê· ë€ ${stats.rankedAvgDamage || 'N/A'}</span>
                        ${!hasTier ? '<br><span class="error">âš ï¸ í‹°ì–´ ì •ë³´ ì—†ìŒ</span>' : ''}
                    </div>
                `;
            }
            
            document.getElementById('currentStats').innerHTML = 
                `<div class="success">âœ… ì´ ${memberCount}ëª… ì¤‘ ${tierCount}ëª… í‹°ì–´ ì •ë³´ ìˆìŒ</div>` + html;
        }
        
        // 2. ì¼ì¼ ìŠ¤ëƒ…ìƒ· ì¡°íšŒ
        async function checkDailyStats() {
            const today = new Date().toISOString().split('T')[0];
            const dailyRef = ref(database, `stats/daily/${today}`);
            const snapshot = await get(dailyRef);
            const data = snapshot.val();
            
            if (data) {
                let html = `<div class="success">âœ… ì˜¤ëŠ˜(${today}) ë°ì´í„° ìˆìŒ</div>`;
                html += `<pre>${JSON.stringify(data, null, 2).substring(0, 500)}...</pre>`;
                document.getElementById('dailyStats').innerHTML = html;
            } else {
                // ê°€ì¥ ìµœê·¼ ë‚ ì§œ ì°¾ê¸°
                const allDailyRef = ref(database, 'stats/daily');
                const allSnapshot = await get(allDailyRef);
                const allData = allSnapshot.val() || {};
                const dates = Object.keys(allData).sort().reverse();
                
                if (dates.length > 0) {
                    const latestDate = dates[0];
                    const latestData = allData[latestDate];
                    let html = `<div class="error">âŒ ì˜¤ëŠ˜ ë°ì´í„° ì—†ìŒ</div>`;
                    html += `<div class="success">ìµœê·¼ ìˆ˜ì§‘: ${latestDate}</div>`;
                    
                    // í‹°ì–´ ì •ë³´ê°€ ìˆëŠ” ë©¤ë²„ ìˆ˜ ê³„ì‚°
                    let tierCount = 0;
                    for (const member of Object.values(latestData)) {
                        if (member.stats && member.stats.tier) tierCount++;
                    }
                    
                    html += `<div>í‹°ì–´ ì •ë³´ê°€ ìˆëŠ” ë©¤ë²„: ${tierCount}ëª…</div>`;
                    html += `<pre>${JSON.stringify(latestData, null, 2).substring(0, 500)}...</pre>`;
                    document.getElementById('dailyStats').innerHTML = html;
                } else {
                    document.getElementById('dailyStats').innerHTML = 
                        '<div class="error">âŒ ì¼ì¼ ë°ì´í„°ê°€ ì „í˜€ ì—†ìŒ (GitHub Actions ì‹¤í–‰ í•„ìš”)</div>';
                }
            }
        }
        
        // 3. íˆìŠ¤í† ë¦¬ ì¡°íšŒ
        async function checkHistoryStats() {
            const historyRef = ref(database, 'stats/history');
            const snapshot = await get(historyRef);
            const history = snapshot.val() || {};
            
            let html = '';
            let totalDates = new Set();
            
            for (const [memberKey, dates] of Object.entries(history)) {
                const dateKeys = Object.keys(dates);
                dateKeys.forEach(d => totalDates.add(d));
                
                const latestDate = dateKeys.sort().pop();
                const latestData = dates[latestDate];
                
                html += `
                    <div class="member-data">
                        <strong>${memberKey}</strong>
                        <br>ğŸ“… ${dateKeys.length}ì¼ ë°ì´í„° ë³´ìœ 
                        <br>ìµœê·¼: ${latestDate}
                        <br>í‹°ì–´: <span class="tier">${latestData.tier || 'ì—†ìŒ'}</span>
                        <br>KD: ${latestData.kd}, í‰ê· ë€: ${latestData.avgDamage}
                    </div>
                `;
            }
            
            const datesArray = Array.from(totalDates).sort();
            document.getElementById('historyStats').innerHTML = 
                `<div class="success">âœ… ${Object.keys(history).length}ëª…ì˜ íˆìŠ¤í† ë¦¬</div>
                 <div>ìˆ˜ì§‘ëœ ë‚ ì§œ: ${datesArray.join(', ')}</div>` + html;
        }
        
        // 4. ë©”íƒ€ë°ì´í„° ì¡°íšŒ
        async function checkMetadata() {
            const metaRef = ref(database, 'stats/metadata/lastCollection');
            const snapshot = await get(metaRef);
            const meta = snapshot.val();
            
            if (meta) {
                const date = new Date(meta.timestamp);
                const html = `
                    <div class="${meta.success ? 'success' : 'error'}">
                        ${meta.success ? 'âœ… ë§ˆì§€ë§‰ ìˆ˜ì§‘ ì„±ê³µ' : 'âŒ ë§ˆì§€ë§‰ ìˆ˜ì§‘ ì‹¤íŒ¨'}
                    </div>
                    <div>ë‚ ì§œ: ${meta.date}</div>
                    <div>ì‹œê°„: ${date.toLocaleString('ko-KR')}</div>
                    <div>ì²˜ë¦¬ëœ ë©¤ë²„: ${meta.membersProcessed || 0}ëª…</div>
                    ${meta.errors && meta.errors.length > 0 ? 
                        `<div class="error">ì—ëŸ¬: ${meta.errors.length}ê°œ</div>` : ''}
                `;
                document.getElementById('metadata').innerHTML = html;
            } else {
                document.getElementById('metadata').innerHTML = 
                    '<div class="error">âŒ ìˆ˜ì§‘ ê¸°ë¡ ì—†ìŒ</div>';
            }
        }
        
        // ì‹¤í–‰
        checkCurrentStats();
        checkDailyStats();
        checkHistoryStats();
        checkMetadata();
        
        // 10ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
        setInterval(() => {
            console.log('ë°ì´í„° ìƒˆë¡œê³ ì¹¨...');
            checkCurrentStats();
            checkDailyStats();
            checkHistoryStats();
            checkMetadata();
        }, 10000);
    </script>
</body>
</html>
