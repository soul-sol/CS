<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>PUBG Stats Test</title>
</head>
<body>
    <h1>PUBG 통계 테스트</h1>
    <input type="text" id="playerName" placeholder="플레이어 이름" value="CS_COSMOS">
    <button onclick="testStats()">통계 가져오기</button>
    <br><br>
    <label>API Key: <input type="text" id="apiKey" style="width:500px" value="eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJmOGY3MzE2MC1hMGY2LTAxM2QtNDU0Zi0xMmU1NjE0MmFkOGQiLCJpc3MiOiJnYW1lbG9ja2VyIiwiaWF0IjoxNzM0NjgxNzAyLCJwdWIiOiJibHVlaG9sZSIsInRpdGxlIjoicHViZyIsImFwcCI6ImJhdHRsZWdyb3VuZC1jIn0.K2KJxFYfX1HXI5bX8vz8nEUhI7kOoYwqyTQ0EQvEjDI"></label>
    <pre id="result"></pre>

    <script>
        const API_KEY = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJmOGY3MzE2MC1hMGY2LTAxM2QtNDU0Zi0xMmU1NjE0MmFkOGQiLCJpc3MiOiJnYW1lbG9ja2VyIiwiaWF0IjoxNzM0NjgxNzAyLCJwdWIiOiJibHVlaG9sZSIsInRpdGxlIjoicHViZyIsImFwcCI6ImJhdHRsZWdyb3VuZC1jIn0.K2KJxFYfX1HXI5bX8vz8nEUhI7kOoYwqyTQ0EQvEjDI';
        const API_BASE_URL = 'https://api.pubg.com/shards/kakao';

        async function testStats() {
            const playerName = document.getElementById('playerName').value;
            const apiKey = document.getElementById('apiKey').value;
            const resultDiv = document.getElementById('result');
            
            try {
                // 1. 플레이어 검색
                resultDiv.textContent = '플레이어 검색 중...';
                const searchResponse = await fetch(
                    `${API_BASE_URL}/players?filter[playerNames]=${playerName}`,
                    {
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Accept': 'application/vnd.api+json'
                        }
                    }
                );
                
                const searchData = await searchResponse.json();
                console.log('Player search response:', searchData);
                
                if (searchData.errors) {
                    resultDiv.textContent = 'API 에러: ' + JSON.stringify(searchData.errors, null, 2);
                    return;
                }
                
                if (!searchData.data || searchData.data.length === 0) {
                    resultDiv.textContent = '플레이어를 찾을 수 없습니다.\n\n전체 응답:\n' + JSON.stringify(searchData, null, 2);
                    return;
                }
                
                const player = searchData.data[0];
                const playerId = player.id;
                
                // 2. 랭크 통계 시도
                resultDiv.textContent += '\n\n랭크 통계 조회 중...';
                const currentSeasonId = 'division.bro.official.pc-2018-29';
                
                const rankedResponse = await fetch(
                    `${API_BASE_URL}/players/${playerId}/seasons/${currentSeasonId}/ranked`,
                    {
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Accept': 'application/vnd.api+json'
                        }
                    }
                );
                
                if (rankedResponse.ok) {
                    const rankedData = await rankedResponse.json();
                    console.log('Ranked stats:', rankedData);
                    resultDiv.textContent += '\n\n=== RANKED STATS ===\n' + JSON.stringify(rankedData, null, 2);
                } else {
                    resultDiv.textContent += '\n\n랭크 통계 없음 (Status: ' + rankedResponse.status + ')';
                }
                
                // 3. 일반 시즌 통계
                resultDiv.textContent += '\n\n일반 시즌 통계 조회 중...';
                const seasonResponse = await fetch(
                    `${API_BASE_URL}/players/${playerId}/seasons/${currentSeasonId}`,
                    {
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Accept': 'application/vnd.api+json'
                        }
                    }
                );
                
                if (seasonResponse.ok) {
                    const seasonData = await seasonResponse.json();
                    console.log('Season stats:', seasonData);
                    
                    // 주요 통계만 추출
                    const stats = seasonData.data.attributes.gameModeStats;
                    const squadStats = stats['squad-fpp'] || stats['squad'] || {};
                    
                    resultDiv.textContent += '\n\n=== SQUAD STATS ===';
                    resultDiv.textContent += '\n라운드: ' + (squadStats.roundsPlayed || 0);
                    resultDiv.textContent += '\n킬: ' + (squadStats.kills || 0);
                    resultDiv.textContent += '\n죽음: ' + (squadStats.losses || 0);
                    resultDiv.textContent += '\n데미지: ' + (squadStats.damageDealt || 0);
                    resultDiv.textContent += '\nK/D: ' + (squadStats.kills && squadStats.losses ? (squadStats.kills / squadStats.losses).toFixed(2) : '0.00');
                    resultDiv.textContent += '\n평균 데미지: ' + (squadStats.roundsPlayed ? Math.round(squadStats.damageDealt / squadStats.roundsPlayed) : 0);
                } else {
                    resultDiv.textContent += '\n\n시즌 통계 없음 (Status: ' + seasonResponse.status + ')';
                }
                
            } catch (error) {
                console.error('Error:', error);
                resultDiv.textContent = '오류: ' + error.message;
            }
        }
    </script>
</body>
</html>
