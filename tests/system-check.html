<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ì‹œìŠ¤í…œ ì „ì²´ ì ê²€</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        h2 { border-bottom: 2px solid #333; padding-bottom: 10px; }
        .check-item {
            margin: 10px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” CountShot í´ëœ í™ˆí˜ì´ì§€ ì‹œìŠ¤í…œ ì ê²€</h1>
    
    <div class="section">
        <h2>ğŸ“Š ì ê²€ ê²°ê³¼</h2>
        <div id="summary"></div>
    </div>
    
    <div class="section">
        <h2>1. Firebase ì—°ê²° ìƒíƒœ</h2>
        <div id="firebase-check"></div>
    </div>
    
    <div class="section">
        <h2>2. ë©¤ë²„ ë°ì´í„° ìƒíƒœ</h2>
        <div id="members-check"></div>
    </div>
    
    <div class="section">
        <h2>3. í˜ì´ì§€ë³„ ì‘ë™ ìƒíƒœ</h2>
        <div id="pages-check"></div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <script>
        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyDKLNkEgvT9x5HqZTDQoR_4vvJLZpTQPxE",
            authDomain: "cs-homepage-5c3c2.firebaseapp.com",
            databaseURL: "https://cs-homepage-5c3c2-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "cs-homepage-5c3c2",
            storageBucket: "cs-homepage-5c3c2.appspot.com",
            messagingSenderId: "297914930278",
            appId: "1:297914930278:web:d0b96e0b5e9c9c5f8f8f8f"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        let checkResults = {
            firebase: false,
            members: false,
            pages: {
                index: 'ì ê²€ ì¤‘...',
                members: 'ì ê²€ ì¤‘...',
                teamBuilder: 'ì ê²€ ì¤‘...'
            }
        };
        
        // 1. Firebase ì—°ê²° ì²´í¬
        function checkFirebase() {
            const div = document.getElementById('firebase-check');
            
            database.ref('.info/connected').on('value', (snap) => {
                if (snap.val() === true) {
                    div.innerHTML = '<div class="check-item success">âœ… Firebase ì—°ê²° ì„±ê³µ</div>';
                    checkResults.firebase = true;
                    checkMembers();
                } else {
                    div.innerHTML = '<div class="check-item error">âŒ Firebase ì—°ê²° ì‹¤íŒ¨</div>';
                }
            });
        }
        
        // 2. ë©¤ë²„ ë°ì´í„° ì²´í¬
        function checkMembers() {
            const div = document.getElementById('members-check');
            
            database.ref('members').once('value').then((snapshot) => {
                const members = snapshot.val() || {};
                const memberCount = Object.keys(members).length;
                
                if (memberCount > 0) {
                    const onlineCount = Object.values(members).filter(m => !m.status || m.status === 'online').length;
                    const offlineCount = Object.values(members).filter(m => m.status && m.status !== 'online').length;
                    const withStats = Object.values(members).filter(m => m.stats && m.stats.kda).length;
                    
                    let html = `
                        <div class="check-item success">âœ… ì´ ${memberCount}ëª…ì˜ ë©¤ë²„ ë°ì´í„° í™•ì¸</div>
                        <div class="check-item">ì˜¨ë¼ì¸: ${onlineCount}ëª… / ì˜¤í”„ë¼ì¸: ${offlineCount}ëª…</div>
                        <div class="check-item">ìŠ¤íƒ¯ ë³´ìœ : ${withStats}ëª… / ${memberCount}ëª…</div>
                    `;
                    
                    // ë¬¸ì œ ìˆëŠ” ë©¤ë²„ ì²´í¬
                    const issues = [];
                    Object.entries(members).forEach(([key, member]) => {
                        if (!member.name) issues.push(`ID ${key}: ì´ë¦„ ì—†ìŒ`);
                        if (key === 'undefined') issues.push(`ì˜ëª»ëœ ID: undefined`);
                    });
                    
                    if (issues.length > 0) {
                        html += '<div class="check-item warning">âš ï¸ ë¬¸ì œ ë°œê²¬:</div>';
                        issues.forEach(issue => {
                            html += `<div class="check-item error">- ${issue}</div>`;
                        });
                    }
                    
                    div.innerHTML = html;
                    checkResults.members = true;
                } else {
                    div.innerHTML = '<div class="check-item error">âŒ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                }
                
                checkPages();
            });
        }
        
        // 3. í˜ì´ì§€ë³„ ì²´í¬
        function checkPages() {
            const div = document.getElementById('pages-check');
            let html = '';
            
            // index.html ì²´í¬
            fetch('/index.html')
                .then(response => {
                    if (response.ok) {
                        html += '<div class="check-item success">âœ… index.html (í‹°ì–´ ê´€ë¦¬) - ì •ìƒ</div>';
                        checkResults.pages.index = 'ì •ìƒ';
                    } else {
                        html += '<div class="check-item error">âŒ index.html - ì ‘ê·¼ ë¶ˆê°€</div>';
                        checkResults.pages.index = 'ì˜¤ë¥˜';
                    }
                })
                .catch(() => {
                    html += '<div class="check-item warning">âš ï¸ index.html - ë¡œì»¬ ì„œë²„ í•„ìš”</div>';
                    checkResults.pages.index = 'ë¡œì»¬ ì„œë²„ í•„ìš”';
                })
                .finally(() => {
                    // members.html ì²´í¬
                    fetch('/members.html')
                        .then(response => {
                            if (response.ok) {
                                html += '<div class="check-item success">âœ… members.html (ë©¤ë²„ ê´€ë¦¬) - ì •ìƒ</div>';
                                checkResults.pages.members = 'ì •ìƒ';
                            } else {
                                html += '<div class="check-item error">âŒ members.html - ì ‘ê·¼ ë¶ˆê°€</div>';
                                checkResults.pages.members = 'ì˜¤ë¥˜';
                            }
                        })
                        .catch(() => {
                            html += '<div class="check-item warning">âš ï¸ members.html - ë¡œì»¬ ì„œë²„ í•„ìš”</div>';
                            checkResults.pages.members = 'ë¡œì»¬ ì„œë²„ í•„ìš”';
                        })
                        .finally(() => {
                            // team-builder.html ì²´í¬
                            fetch('/team-builder.html')
                                .then(response => {
                                    if (response.ok) {
                                        html += '<div class="check-item success">âœ… team-builder.html (íŒ€ ë¹Œë”) - ì •ìƒ</div>';
                                        checkResults.pages.teamBuilder = 'ì •ìƒ';
                                    } else {
                                        html += '<div class="check-item error">âŒ team-builder.html - ì ‘ê·¼ ë¶ˆê°€</div>';
                                        checkResults.pages.teamBuilder = 'ì˜¤ë¥˜';
                                    }
                                })
                                .catch(() => {
                                    html += '<div class="check-item warning">âš ï¸ team-builder.html - ë¡œì»¬ ì„œë²„ í•„ìš”</div>';
                                    checkResults.pages.teamBuilder = 'ë¡œì»¬ ì„œë²„ í•„ìš”';
                                })
                                .finally(() => {
                                    div.innerHTML = html;
                                    updateSummary();
                                });
                        });
                });
        }
        
        // ìš”ì•½ ì—…ë°ì´íŠ¸
        function updateSummary() {
            const div = document.getElementById('summary');
            let status = 'success';
            
            if (!checkResults.firebase || !checkResults.members) {
                status = 'error';
            }
            
            const className = status === 'success' ? 'success' : 'error';
            const icon = status === 'success' ? 'âœ…' : 'âŒ';
            const message = status === 'success' ? 'ëª¨ë“  ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™' : 'ì¼ë¶€ ë¬¸ì œ ë°œê²¬';
            
            div.innerHTML = `
                <h3 class="${className}">${icon} ${message}</h3>
                <ul>
                    <li>Firebase ì—°ê²°: ${checkResults.firebase ? 'âœ… ì •ìƒ' : 'âŒ ì˜¤ë¥˜'}</li>
                    <li>ë©¤ë²„ ë°ì´í„°: ${checkResults.members ? 'âœ… ì •ìƒ' : 'âŒ ì˜¤ë¥˜'}</li>
                    <li>í˜ì´ì§€ ìƒíƒœ:
                        <ul>
                            <li>í‹°ì–´ ê´€ë¦¬: ${checkResults.pages.index}</li>
                            <li>ë©¤ë²„ ê´€ë¦¬: ${checkResults.pages.members}</li>
                            <li>íŒ€ ë¹Œë”: ${checkResults.pages.teamBuilder}</li>
                        </ul>
                    </li>
                </ul>
                <p><strong>ê¶Œì¥ì‚¬í•­:</strong></p>
                <ul>
                    <li>ë¡œì»¬ ì„œë²„ ì‹¤í–‰ ì¤‘: http://localhost:8000</li>
                    <li>Firebase Database URL: asia-southeast1 ë¦¬ì „ ì‚¬ìš©</li>
                    <li>ëª¨ë“  í˜ì´ì§€ ì •ìƒ ì‘ë™ í™•ì¸</li>
                </ul>
            `;
        }
        
        // ì ê²€ ì‹œì‘
        checkFirebase();
    </script>
</body>
</html>