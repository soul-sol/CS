<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>undefined 멤버 제거</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
</head>
<body>
    <h1>undefined 멤버 제거</h1>
    <div id="output"></div>
    
    <script>
        // Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyDKLNkEgvT9x5HqZTDQoR_4vvJLZpTQPxE",
            authDomain: "cs-homepage-5c3c2.firebaseapp.com",
            databaseURL: "https://cs-homepage-5c3c2-default-rtdb.firebaseio.com",
            projectId: "cs-homepage-5c3c2",
            storageBucket: "cs-homepage-5c3c2.appspot.com",
            messagingSenderId: "297914930278",
            appId: "1:297914930278:web:d0b96e0b5e9c9c5f8f8f8f"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const output = document.getElementById('output');
        
        function log(message) {
            console.log(message);
            output.innerHTML += message + '<br>';
        }
        
        async function removeUndefinedMember() {
            log('🔧 undefined 멤버 제거 시작...');
            
            try {
                const membersRef = database.ref('members');
                const snapshot = await membersRef.once('value');
                const members = snapshot.val() || {};
                
                log(`현재 멤버 수: ${Object.keys(members).length}`);
                
                // undefined 멤버 찾기 및 제거
                let removedCount = 0;
                const removeTasks = [];
                
                for (const [key, member] of Object.entries(members)) {
                    if (key === 'undefined' || !member || !member.name || member.name === 'undefined') {
                        log(`❌ 제거 대상: ${key} - ${member?.name || 'undefined'}`);
                        removeTasks.push(membersRef.child(key).remove());
                        removedCount++;
                    }
                }
                
                if (removeTasks.length > 0) {
                    await Promise.all(removeTasks);
                    log(`<br>✅ ${removedCount}개의 잘못된 멤버 데이터를 제거했습니다.`);
                } else {
                    log('<br>✅ 제거할 잘못된 멤버가 없습니다.');
                }
                
                // 최종 멤버 수 확인
                const finalSnapshot = await membersRef.once('value');
                const finalMembers = finalSnapshot.val() || {};
                log(`최종 멤버 수: ${Object.keys(finalMembers).length}`);
                
                // 스탯 없는 멤버 목록
                log('<br>📊 스탯 업데이트가 필요한 멤버:');
                const needsUpdate = [];
                for (const [key, member] of Object.entries(finalMembers)) {
                    if (!member.stats || !member.stats.kda) {
                        needsUpdate.push(member.name);
                        log(`- ${member.name}`);
                    }
                }
                
                if (needsUpdate.length > 0) {
                    log(`<br>총 ${needsUpdate.length}명의 멤버가 스탯 업데이트가 필요합니다.`);
                }
                
            } catch (error) {
                log(`❌ 오류 발생: ${error.message}`);
                console.error(error);
            }
        }
        
        // 실행
        removeUndefinedMember();
    </script>
</body>
</html>
