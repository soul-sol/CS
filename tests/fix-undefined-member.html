<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>undefined ë©¤ë²„ ì œê±°</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
</head>
<body>
    <h1>undefined ë©¤ë²„ ì œê±°</h1>
    <div id="output"></div>
    
    <script>
        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyDKLNkEgvT9x5HqZTDQoR_4vvJLZpTQPxE",
            authDomain: "cs-homepage-5c3c2.firebaseapp.com",
            databaseURL: "https://cs-homepage-5c3c2-default-rtdb.firebaseio.com",
            projectId: "cs-homepage-5c3c2",
            storageBucket: "cs-homepage-5c3c2.appspot.com",
            messagingSenderId: "297914930278",
            appId: "1:297914930278:web:d0b96e0b5e9c9c5f8f8f8f"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const output = document.getElementById('output');
        
        function log(message) {
            console.log(message);
            output.innerHTML += message + '<br>';
        }
        
        async function removeUndefinedMember() {
            log('ğŸ”§ undefined ë©¤ë²„ ì œê±° ì‹œì‘...');
            
            try {
                const membersRef = database.ref('members');
                const snapshot = await membersRef.once('value');
                const members = snapshot.val() || {};
                
                log(`í˜„ì¬ ë©¤ë²„ ìˆ˜: ${Object.keys(members).length}`);
                
                // undefined ë©¤ë²„ ì°¾ê¸° ë° ì œê±°
                let removedCount = 0;
                const removeTasks = [];
                
                for (const [key, member] of Object.entries(members)) {
                    if (key === 'undefined' || !member || !member.name || member.name === 'undefined') {
                        log(`âŒ ì œê±° ëŒ€ìƒ: ${key} - ${member?.name || 'undefined'}`);
                        removeTasks.push(membersRef.child(key).remove());
                        removedCount++;
                    }
                }
                
                if (removeTasks.length > 0) {
                    await Promise.all(removeTasks);
                    log(`<br>âœ… ${removedCount}ê°œì˜ ì˜ëª»ëœ ë©¤ë²„ ë°ì´í„°ë¥¼ ì œê±°í–ˆìŠµë‹ˆë‹¤.`);
                } else {
                    log('<br>âœ… ì œê±°í•  ì˜ëª»ëœ ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                // ìµœì¢… ë©¤ë²„ ìˆ˜ í™•ì¸
                const finalSnapshot = await membersRef.once('value');
                const finalMembers = finalSnapshot.val() || {};
                log(`ìµœì¢… ë©¤ë²„ ìˆ˜: ${Object.keys(finalMembers).length}`);
                
                // ìŠ¤íƒ¯ ì—†ëŠ” ë©¤ë²„ ëª©ë¡
                log('<br>ğŸ“Š ìŠ¤íƒ¯ ì—…ë°ì´íŠ¸ê°€ í•„ìš”í•œ ë©¤ë²„:');
                const needsUpdate = [];
                for (const [key, member] of Object.entries(finalMembers)) {
                    if (!member.stats || !member.stats.kda) {
                        needsUpdate.push(member.name);
                        log(`- ${member.name}`);
                    }
                }
                
                if (needsUpdate.length > 0) {
                    log(`<br>ì´ ${needsUpdate.length}ëª…ì˜ ë©¤ë²„ê°€ ìŠ¤íƒ¯ ì—…ë°ì´íŠ¸ê°€ í•„ìš”í•©ë‹ˆë‹¤.`);
                }
                
            } catch (error) {
                log(`âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
                console.error(error);
            }
        }
        
        // ì‹¤í–‰
        removeUndefinedMember();
    </script>
</body>
</html>
