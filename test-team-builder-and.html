<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Builder AND ì¡°ê±´ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #00ff00;
            text-align: center;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #444;
            border-radius: 8px;
            background: #222;
        }
        h2 {
            color: #00aaff;
        }
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .team-card {
            padding: 15px;
            border: 2px solid #444;
            border-radius: 8px;
            background: #2a2a2a;
        }
        .team-card.valid {
            border-color: #00ff00;
        }
        .team-card.invalid {
            border-color: #ff0000;
        }
        .team-header {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 18px;
        }
        .member {
            padding: 5px;
            margin: 3px 0;
            border-radius: 4px;
        }
        .tier1 { background: #4a4a00; color: #ffff00; }
        .tier2 { background: #4a0000; color: #ff6666; }
        .tier3 { background: #004a00; color: #66ff66; }
        .tier4 { background: #00004a; color: #6666ff; }
        .unassigned { background: #333; color: #aaa; }
        .validation {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .validation.pass {
            background: #004400;
            color: #00ff00;
        }
        .validation.fail {
            background: #440000;
            color: #ff0000;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #333;
            color: white;
            border: 1px solid #666;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #444;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            text-align: center;
        }
        .success { background: #004400; color: #00ff00; }
        .error { background: #440000; color: #ff0000; }
        .info { background: #000044; color: #00aaff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ Team Builder AND ì¡°ê±´ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-section">
            <h2>í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤</h2>
            <button onclick="runTest()">AND ì¡°ê±´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <div id="status"></div>
        </div>

        <div class="test-section">
            <h2>íŒ€ êµ¬ì„± ê²°ê³¼</h2>
            <div id="teamResults"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyCWEWmussrZcqv4LgCvjUdcuzRcaUST3Ls",
            authDomain: "cs-homepage-5c3c2.firebaseapp.com",
            databaseURL: "https://cs-homepage-5c3c2-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "cs-homepage-5c3c2",
            storageBucket: "cs-homepage-5c3c2.firebasestorage.app",
            messagingSenderId: "117726976721",
            appId: "1:117726976721:web:f9dd3297e82113414183f0",
            measurementId: "G-9XZ9SJ3D78"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        let members = {};
        
        // Firebase ë°ì´í„° ë¡œë“œ
        onValue(ref(database, 'members'), (snapshot) => {
            members = snapshot.val() || {};
            showStatus('Firebase ë°ì´í„° ë¡œë“œ ì™„ë£Œ', 'success');
        });
        
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        // ê°œì„ ëœ íŒ€ ìƒì„± í•¨ìˆ˜ (AND ì¡°ê±´ ì ìš©)
        function createTeamsWithAND(membersList, teamCount) {
            const teams = Array.from({ length: teamCount }, () => []);
            let availableMembers = [...membersList];
            
            // 1ë‹¨ê³„: 1í‹°ì–´ ë°°ì¹˜ (ê° íŒ€ì— í•˜ë‚˜ì”©)
            const tier1Members = availableMembers.filter(m => m.tier === 'tier1');
            let otherMembers = availableMembers.filter(m => m.tier !== 'tier1');
            
            tier1Members.forEach((member, index) => {
                if (index < teamCount) {
                    teams[index].push(member);
                } else {
                    // ë‚¨ì€ 1í‹°ì–´ëŠ” ê°€ì¥ ì ì€ íŒ€ì— ë°°ì¹˜
                    let minTeamIndex = 0;
                    let minTeamSize = teams[0].length;
                    for (let i = 1; i < teamCount; i++) {
                        if (teams[i].length < minTeamSize) {
                            minTeamSize = teams[i].length;
                            minTeamIndex = i;
                        }
                    }
                    teams[minTeamIndex].push(member);
                }
            });
            
            availableMembers = otherMembers;
            
            // 2ë‹¨ê³„: 2í‹°ì–´ ë°°ì¹˜ (ê° íŒ€ì— í•˜ë‚˜ì”©)
            const tier2Members = availableMembers.filter(m => m.tier === 'tier2');
            otherMembers = availableMembers.filter(m => m.tier !== 'tier2');
            
            tier2Members.forEach((member, index) => {
                if (index < teamCount) {
                    // ê° íŒ€ì— í•˜ë‚˜ì”© ë°°ì¹˜
                    teams[index].push(member);
                } else {
                    // ë‚¨ì€ 2í‹°ì–´ëŠ” ê°€ì¥ ì ì€ íŒ€ì— ë°°ì¹˜
                    let minTeamIndex = 0;
                    let minTeamSize = teams[0].length;
                    for (let i = 1; i < teamCount; i++) {
                        if (teams[i].length < minTeamSize) {
                            minTeamSize = teams[i].length;
                            minTeamIndex = i;
                        }
                    }
                    teams[minTeamIndex].push(member);
                }
            });
            
            availableMembers = otherMembers;
            
            // 3ë‹¨ê³„: ë‚˜ë¨¸ì§€ ë©¤ë²„ ê· ë“± ë°°ì¹˜
            availableMembers.forEach(member => {
                let minTeamIndex = 0;
                let minTeamSize = teams[0].length;
                for (let i = 1; i < teamCount; i++) {
                    if (teams[i].length < minTeamSize) {
                        minTeamSize = teams[i].length;
                        minTeamIndex = i;
                    }
                }
                teams[minTeamIndex].push(member);
            });
            
            return teams;
        }
        
        // íŒ€ ê²€ì¦ í•¨ìˆ˜
        function validateTeam(team) {
            const hasTier1 = team.some(m => m.tier === 'tier1');
            const hasTier2 = team.some(m => m.tier === 'tier2');
            return { hasTier1, hasTier2, isValid: hasTier1 && hasTier2 };
        }
        
        // í‹°ì–´ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
        function getTierName(tier) {
            switch(tier) {
                case 'tier1': return '1í‹°ì–´';
                case 'tier2': return '2í‹°ì–´';
                case 'tier3': return '3í‹°ì–´';
                case 'tier4': return '4í‹°ì–´';
                default: return 'ë¬´ì†Œì†';
            }
        }
        
        // í‹°ì–´ í´ë˜ìŠ¤ ê°€ì ¸ì˜¤ê¸°
        function getTierClass(tier) {
            switch(tier) {
                case 'tier1': return 'tier1';
                case 'tier2': return 'tier2';
                case 'tier3': return 'tier3';
                case 'tier4': return 'tier4';
                default: return 'unassigned';
            }
        }
        
        window.runTest = function() {
            const onlineMembers = Object.values(members).filter(m => !m.status || m.status === 'online');
            
            if (onlineMembers.length === 0) {
                showStatus('ì˜¨ë¼ì¸ ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            const teamCount = 4;
            const teams = createTeamsWithAND(onlineMembers, teamCount);
            
            let html = '<div class="team-grid">';
            let allValid = true;
            
            teams.forEach((team, index) => {
                const validation = validateTeam(team);
                if (!validation.isValid) allValid = false;
                
                const tierCounts = {};
                team.forEach(m => {
                    const tier = m.tier || 'unassigned';
                    tierCounts[tier] = (tierCounts[tier] || 0) + 1;
                });
                
                html += `
                    <div class="team-card ${validation.isValid ? 'valid' : 'invalid'}">
                        <div class="team-header">Team ${index + 1} (${team.length}ëª…)</div>
                        <div style="font-size: 14px; color: #888; margin-bottom: 10px;">
                            ${Object.entries(tierCounts).map(([tier, count]) => 
                                `${getTierName(tier)}: ${count}`
                            ).join(' | ')}
                        </div>
                        ${team.map(member => `
                            <div class="member ${getTierClass(member.tier)}">
                                ${member.tier === 'tier1' ? 'ğŸ‘‘' : ''}
                                ${member.tier === 'tier2' ? 'ğŸ”¥' : ''}
                                ${member.tier === 'tier3' ? 'ğŸŒŸ' : ''}
                                ${member.tier === 'tier4' ? 'âš”ï¸' : ''}
                                ${!member.tier || member.tier === 'unassigned' ? 'ğŸ“‹' : ''}
                                ${member.name}
                            </div>
                        `).join('')}
                        <div class="validation ${validation.isValid ? 'pass' : 'fail'}">
                            1í‹°ì–´: ${validation.hasTier1 ? 'âœ…' : 'âŒ'} | 
                            2í‹°ì–´: ${validation.hasTier2 ? 'âœ…' : 'âŒ'}
                            ${validation.isValid ? ' â†’ AND ì¡°ê±´ ì¶©ì¡± âœ…' : ' â†’ AND ì¡°ê±´ ë¯¸ì¶©ì¡± âŒ'}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            if (allValid) {
                html += '<div class="validation pass" style="margin-top: 20px; text-align: center; font-size: 18px;">âœ… ëª¨ë“  íŒ€ì´ AND ì¡°ê±´ì„ ì¶©ì¡±í•©ë‹ˆë‹¤! (ê° íŒ€ì— 1í‹°ì–´ì™€ 2í‹°ì–´ê°€ ëª¨ë‘ ìˆìŒ)</div>';
            } else {
                html += '<div class="validation fail" style="margin-top: 20px; text-align: center; font-size: 18px;">âŒ ì¼ë¶€ íŒ€ì´ AND ì¡°ê±´ì„ ì¶©ì¡±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤!</div>';
            }
            
            document.getElementById('teamResults').innerHTML = html;
            showStatus(`í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ${allValid ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'}`, allValid ? 'success' : 'error');
        };
    </script>
</body>
</html>


